/*! For license information please see taskpane.js.LICENSE.txt */
!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,i,s=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw i}}}}function r(e,t){if(e){if("string"==typeof e)return a(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function o(){"use strict";o=function(){return n};var t,n={},r=Object.prototype,a=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function l(e,t,n,r){return Object.defineProperty(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r})}try{l({},"")}catch(t){l=function(e,t,n){return e[t]=n}}function p(e,n,r,a){var o=n&&n.prototype instanceof h?n:h,i=Object.create(o.prototype);return l(i,"_invoke",function(e,n,r){var a=1;return function(o,i){if(3===a)throw Error("Generator is already running");if(4===a){if("throw"===o)throw i;return{value:t,done:!0}}for(r.method=o,r.arg=i;;){var s=r.delegate;if(s){var c=E(s,r);if(c){if(c===f)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(1===a)throw a=4,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=3;var u=d(e,n,r);if("normal"===u.type){if(a=r.done?4:2,u.arg===f)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(a=4,r.method="throw",r.arg=u.arg)}}}(e,r,new R(a||[])),!0),i}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=p;var f={};function h(){}function v(){}function y(){}var m={};l(m,s,(function(){return this}));var g=Object.getPrototypeOf,x=g&&g(g(A([])));x&&x!==r&&a.call(x,s)&&(m=x);var b=y.prototype=h.prototype=Object.create(m);function w(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(t,n){function r(o,i,s,c){var u=d(t[o],t,i);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==e(p)&&a.call(p,"__await")?n.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):n.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var o;l(this,"_invoke",(function(e,t){function a(){return new n((function(n,a){r(e,t,n,a)}))}return o=o?o.then(a,a):a()}),!0)}function E(e,n){var r=n.method,a=e.i[r];if(a===t)return n.delegate=null,"throw"===r&&e.i.return&&(n.method="return",n.arg=t,E(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=d(a,e.i,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,f;var i=o.arg;return i?i.done?(n[e.r]=i.value,n.next=e.n,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,f):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}function C(e){this.tryEntries.push(e)}function I(e){var n=e[4]||{};n.type="normal",n.arg=t,e[4]=n}function R(e){this.tryEntries=[[-1]],e.forEach(C,this),this.reset(!0)}function A(n){if(null!=n){var r=n[s];if(r)return r.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var o=-1,i=function e(){for(;++o<n.length;)if(a.call(n,o))return e.value=n[o],e.done=!1,e;return e.value=t,e.done=!0,e};return i.next=i}}throw new TypeError(e(n)+" is not iterable")}return v.prototype=y,l(b,"constructor",y),l(y,"constructor",v),v.displayName=l(y,u,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,u,"GeneratorFunction")),e.prototype=Object.create(b),e},n.awrap=function(e){return{__await:e}},w(k.prototype),l(k.prototype,c,(function(){return this})),n.AsyncIterator=k,n.async=function(e,t,r,a,o){void 0===o&&(o=Promise);var i=new k(p(e,t,r,a),o);return n.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(b),l(b,u,"Generator"),l(b,s,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.unshift(r);return function e(){for(;n.length;)if((r=n.pop())in t)return e.value=r,e.done=!1,e;return e.done=!0,e}},n.values=A,R.prototype={constructor:R,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(t){i.type="throw",i.arg=e,n.next=t}for(var a=n.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o[4],s=this.prev,c=o[1],u=o[2];if(-1===o[0])return r("end"),!1;if(!c&&!u)throw Error("try statement without catch or finally");if(null!=o[0]&&o[0]<=s){if(s<c)return this.method="next",this.arg=t,r(c),!0;if(s<u)return r(u),!1}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r[0]>-1&&r[0]<=this.prev&&this.prev<r[2]){var a=r;break}}a&&("break"===e||"continue"===e)&&a[0]<=t&&t<=a[2]&&(a=null);var o=a?a[4]:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a[2],f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n[2]===e)return this.complete(n[4],n[3]),I(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n[0]===e){var r=n[4];if("throw"===r.type){var a=r.arg;I(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={i:A(e),r:n,n:r},"next"===this.method&&(this.arg=t),f}},n}function i(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){i(o,r,a,s,c,"next",e)}function c(e){i(o,r,a,s,c,"throw",e)}s(void 0)}))}}var c,u,l,p={currentScreen:"welcome"},d=1,f=0,h=0,v=!1,y=0,m=0,g=null,x=[],b=null,w=null,k=null,E=0,C=[],I=!1,R=!1,A=!0,B=null,T=!1,F=!1;function L(){["welcome-screen","main-menu","drilling-interface","export-instructions"].forEach((function(e){var t=document.getElementById(e);t&&(t.style.display="none")}))}function S(e){switch(L(),p.currentScreen=e,e){case"welcome":document.getElementById("welcome-screen").style.display="flex";break;case"menu":we(),document.getElementById("main-menu").style.display="flex";break;case"drilling":document.getElementById("drilling-interface").style.display="block",I||ie();break;case"export-instructions":document.getElementById("export-instructions").style.display="flex"}}function P(){return D.apply(this,arguments)}function D(){return D=s(o().mark((function e(){var t,r,a,i,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("confirm-reset"),r=document.getElementById("reset-project-btn"),a=r.textContent,i=r.className,c=r.style.backgroundColor,e.prev=5,t.style.display="none",r.disabled=!0,r.classList.add("disabled"),r.style.backgroundColor="#cccccc",r.textContent="Réinitialisation en cours...",e.next=13,Excel.run(function(){var e=s(o().mark((function e(t){var r,a,i,s,c,u,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i in r=t.workbook.worksheets,a={ACCUEIL:["B13:I150"],Feuil1:["A37:B170","F37:J170"]})if(a.hasOwnProperty(i)){s=r.getItem(i),c=n(a[i]);try{for(c.s();!(u=c.n()).done;)l=u.value,s.getRange(l).clear(Excel.ClearApplyTo.all)}catch(e){c.e(e)}finally{c.f()}}return e.next=5,t.sync();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 13:r.classList.remove("disabled"),r.classList.add("success"),r.style.backgroundColor="#28a745",r.innerHTML="✓ Réinitialisation réussie",setTimeout((function(){r.disabled=!1,r.style.backgroundColor=c,r.className=i,r.textContent=a}),3e3),e.next=29;break;case 20:e.prev=20,e.t0=e.catch(5),console.error("Échec de la réinitialisation:",e.t0),r.classList.remove("disabled"),r.classList.add("error"),r.style.backgroundColor="#dc3545",r.innerHTML="✗ Échec de la réinitialisation",r.disabled=!1,setTimeout((function(){r.style.backgroundColor=c,r.className=i,r.textContent=a}),3e3);case 29:case"end":return e.stop()}}),e,null,[[5,20]])}))),D.apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return O=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Excel.run(function(){var e=s(o().mark((function e(t){var r,a,i,s,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=t.workbook.worksheets).load("items/name,items/visibility"),e.next=4,t.sync();case 4:return(a=r.getItem("ACCUEIL")).load("visibility"),e.next=8,t.sync();case 8:if("Visible"===a.visibility){e.next=12;break}return a.visibility="Visible",e.next=12,t.sync();case 12:return a.activate(),e.next=15,t.sync();case 15:i=n(r.items);try{for(i.s();!(s=i.n()).done;)"ACCUEIL"!==(c=s.value).name&&"Visible"===c.visibility&&(c.visibility="Hidden")}catch(e){i.e(e)}finally{i.f()}return e.next=19,t.sync();case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:S("menu"),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.error("Erreur lors du retour à ACCUEIL :",e.t0),xe("Erreur : ".concat(e.t0.message));case 10:case"end":return e.stop()}}),e,null,[[0,6]])}))),O.apply(this,arguments)}function G(e){return H.apply(this,arguments)}function H(){return H=s(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&Array.isArray(t)&&0!==t.length){e.next=2;break}throw new Error("Le paramètre feuillesAAfficher doit être un tableau non vide");case 2:return e.prev=2,e.next=5,Excel.run(function(){var e=s(o().mark((function e(n){var r,a,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=n.workbook.worksheets).load("items/name"),e.next=4,n.sync();case 4:return a=r.items.map((function(e){return e.name})),t.filter((function(e){return a.includes(e)})).forEach((function(e){n.workbook.worksheets.getItem(e).visibility="Visible"})),e.next=9,n.sync();case 9:(i=t.filter((function(e){return!a.includes(e)}))).length>0&&console.warn("Feuilles non trouvées:",i);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(2),console.error("Erreur dans unhideSheetsExport:",e.t0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[2,7]])}))),H.apply(this,arguments)}function K(e){return N.apply(this,arguments)}function N(){return N=s(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=!1,e.next=4,Excel.run(function(){var e=s(o().mark((function e(r){var a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=r.workbook.worksheets.getItem(t)).load("visibility"),e.next=4,r.sync();case 4:n="Visible"===a.visibility;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:return e.abrupt("return",n);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Erreur lors de la vérification de la visibilité de ".concat(t,":"),e.t0),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,null,[[0,7]])}))),N.apply(this,arguments)}function U(e){return _.apply(this,arguments)}function _(){return _=s(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Excel.run(function(){var e=s(o().mark((function e(r){var a,i,s,c,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=r.workbook.worksheets).load("items/name,items/visibility"),e.next=4,r.sync();case 4:if(i=a.items.find((function(e){return t.includes(e.name)})),!i){e.next=9;break}return i.activate(),e.next=9,r.sync();case 9:s=n(a.items);try{for(s.s();!(c=s.n()).done;)u=c.value,t.includes(u.name)||"Visible"!==u.visibility||(u.visibility="Hidden")}catch(e){s.e(e)}finally{s.f()}return e.next=13,r.sync();case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:e.next=9;break;case 5:throw e.prev=5,e.t0=e.catch(0),console.error("Erreur lors du masquage des feuilles:",e.t0),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,5]])}))),_.apply(this,arguments)}function V(e){Excel.run(function(){var t=s(o().mark((function t(n){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.workbook.worksheets.getItem(e).visibility="Visible",t.next=4,n.sync();case 4:console.log("".concat(e," affichée"));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(e){console.error("Erreur:",e)}))}function Y(){var e=document.createElement("div");e.innerHTML='\n        <div style="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background-color: rgba(248, 154, 23, 0.77);\n            backdrop-filter: blur(6px);\n            color: white;\n            padding: 12px 40px 12px 20px;\n            border-radius: 6px;\n            z-index: 1000;\n            font-family: \'Segoe UI\', sans-serif;\n            font-size: 14px;\n            font-weight: 500;\n            box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n            border: 1px solid rgba(255,255,255,0.2);\n            animation: gentleFadeIn 0.3s ease-out;\n            max-width: 320px;\n            line-height: 1.4;\n        ">\n            <div style="display: flex; align-items: center; gap: 8px;">\n                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                    <path d="M12 9v2m0 4h.01"></path>\n                    <circle cx="12" cy="12" r="10"></circle>\n                </svg>\n                <span>Modification détectée : veuillez actualiser les données en revenant à l\'étape 1</span>\n            </div>\n            <div class="close-btn" style="\n                position: absolute;\n                top: 10px;\n                right: 10px;\n                width: 16px;\n                height: 16px;\n                cursor: pointer;\n                opacity: 0.8;\n                transition: all 0.2s;\n                font-size: 18px;\n                line-height: 16px;\n                text-align: center;\n            ">×</div>\n        </div>\n    ';var t=document.createElement("style");t.textContent="\n        @keyframes gentleFadeIn {\n            from { opacity: 0; transform: translateY(10px) scale(0.98); }\n            to { opacity: 1; transform: translateY(0) scale(1); }\n        }\n    ",document.head.appendChild(t),document.body.appendChild(e);var n=e.querySelector(".close-btn");n.addEventListener("click",(function(){e.style.opacity="0",setTimeout((function(){return e.remove()}),300)})),n.addEventListener("mouseenter",(function(){n.style.opacity="1",n.style.transform="scale(1.1)"})),n.addEventListener("mouseleave",(function(){n.style.opacity="0.8",n.style.transform="scale(1)"})),setTimeout((function(){e.parentNode&&(e.style.opacity="0",setTimeout((function(){return e.remove()}),300))}),8e3),F=!0,setTimeout((function(){F=!1,T=!1}),3e4)}function j(){return z.apply(this,arguments)}function z(){return(z=s(o().mark((function e(){var t,n,r,a,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("prepare-pdf-btn"),n=t.textContent,r=t.style.backgroundColor,a=!1,i=["PDG","Intro","TempExportPlan","TempExportComplet","P_KITS","TempExport","RecapPieces","RecapTubes"],e.prev=5,t.disabled=!0,t.style.backgroundColor="#cccccc",t.textContent="Préparation en cours... merci de patienter",e.next=11,K("ACCUEIL");case 11:if(e.sent){e.next=15;break}return e.next=15,V("ACCUEIL");case 15:return e.next=17,G(i);case 17:return e.next=19,U(i);case 19:return e.next=21,de("TempExport",!1,"Gp4r!74.");case 21:return a=!0,e.next=24,J();case 24:return e.next=26,de("TempExport",!0,"Gp4r!74.");case 26:return a=!1,e.next=29,q();case 29:S("export-instructions"),e.next=45;break;case 32:if(e.prev=32,e.t0=e.catch(5),console.error("Erreur dans preparerExportPDF:",e.t0),!a){e.next=44;break}return e.prev=36,e.next=39,de("TempExport",!0,"Gp4r!74.");case 39:e.next=44;break;case 41:e.prev=41,e.t1=e.catch(36),console.error("Erreur lors du reverrouillage d'urgence de TempExport:",e.t1);case 44:xe("Erreur lors de la préparation du PDF : ".concat(e.t0.message));case 45:return e.prev=45,t.disabled=!1,t.style.backgroundColor=r,t.textContent=n,e.finish(45);case 50:case"end":return e.stop()}}),e,null,[[5,32,45,50],[36,41]])})))).apply(this,arguments)}function q(){return X.apply(this,arguments)}function X(){return X=s(o().mark((function e(){var t,n,r,a,i,u,l,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="none"!==document.getElementById("welcome-screen").style.display?"welcome":"none"!==document.getElementById("main-menu").style.display?"menu":"none"!==document.getElementById("drilling-interface").style.display?"drilling":null,(n=document.createElement("div")).style.cssText="\n    position: fixed;\n    top: 0; left: 0;\n    width: 100vw;\n    height: 100vh;\n    background: white;\n    z-index: 9999;\n    display: none;\n  ",document.body.appendChild(n),e.prev=4,n.style.display="block",document.body.style.transition="none",S("drilling"),R=!0,be(),e.next=12,ae();case 12:return e.next=14,new Promise((function(e){return requestAnimationFrame((function(){return requestAnimationFrame(e)}))}));case 14:return(r=document.createElement("canvas")).width=1020,r.height=700,(a=r.getContext("2d")).imageSmoothingEnabled=!0,a.drawImage(c,0,0),i=r.toDataURL("image/png"),be(),e.next=24,ae();case 24:return e.next=26,Pe();case 26:return e.next=28,new Promise((function(e){return requestAnimationFrame((function(){return requestAnimationFrame(e)}))}));case 28:return(u=document.createElement("canvas")).width=1020,u.height=700,(l=u.getContext("2d")).imageSmoothingEnabled=!0,l.drawImage(c,0,0),p=u.toDataURL("image/png"),e.next=37,Excel.run(function(){var e=s(o().mark((function e(t){var n,r,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.workbook.worksheets.getItem("TempExportPlan"),(r=n.shapes).load("items"),e.next=5,t.sync();case 5:return r.items.forEach((function(e){return e.delete()})),n.shapes.addImage(i.split(",")[1],{left:0,top:0,width:842,height:595}),a=t.workbook.worksheets.getItem("TempExportComplet"),(s=a.shapes).load("items"),e.next=12,t.sync();case 12:return s.items.forEach((function(e){return e.delete()})),a.shapes.addImage(p.split(",")[1],{left:0,top:0,width:842,height:595}),e.next=16,t.sync();case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 37:"menu"===t&&S("menu"),e.next=44;break;case 40:e.prev=40,e.t0=e.catch(4),console.error("Export failed:",e.t0),xe("Erreur d'export : ".concat(e.t0.message));case 44:return e.prev=44,R=!1,be(),document.body.style.transition="",n.remove(),e.finish(44);case 50:case"end":return e.stop()}}),e,null,[[4,40,44,50]])}))),X.apply(this,arguments)}function J(){return W.apply(this,arguments)}function W(){return W=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Excel.run(function(){var e=s(o().mark((function e(t){var n,r,a,i,s,c,u,l,p,d,f,h,v,y,m;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.workbook,r=["P_RONDS","P_CCR"],(a=n.worksheets.getItem("TempExport")).getUsedRange().clear(),a.getRange("B:B").columnWidth=30,i=1,s=0,c=r;case 7:if(!(s<c.length)){e.next=40;break}return u=c[s],l=n.worksheets.getItem(u),(p=l.getUsedRange()).load("rowCount"),e.next=14,t.sync();case 14:return d=p.rowCount,(f=l.getRange("B5:B".concat(d))).load("values"),e.next=19,t.sync();case 19:h=5;case 20:if(!(h<=d)){e.next=37;break}for(v=!1,y=h,m=0;m<20&&h+m<=d;m++)f.values[m]&&""!==f.values[m][0]&&(v=!0,y=h+m);if(v){e.next=27;break}return h+=20,e.abrupt("continue",20);case 27:return y=Math.min(h+19,d),e.next=30,Z(t,l,a,"C1:R4","A".concat(h,":B").concat(y),"C".concat(h,":R").concat(y),i);case 30:return i+=27,e.next=33,Z(t,l,a,"S1:AH4","A".concat(h,":B").concat(y),"S".concat(h,":AH").concat(y),i);case 33:i+=25,h+=20,e.next=20;break;case 37:s++,e.next=7;break;case 40:return a.getRange("B1").getEntireColumn().format.autofitColumns(),e.next=44,t.sync();case 44:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("❌ Erreur:",e.t0),e.t0 instanceof OfficeExtension.Error&&console.error("Détails:",JSON.stringify(e.t0.debugInfo));case 9:case"end":return e.stop()}}),e,null,[[0,5]])}))),W.apply(this,arguments)}function Z(e,t,n,r,a,o,i){return Q.apply(this,arguments)}function Q(){return(Q=s(o().mark((function e(t,n,r,a,i,s,c){var u,l,p,d,f,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u=n.getRange(a),l=n.getRange(i),p=n.getRange(s),u.load("rowCount, columnCount, format"),l.load("rowCount, format"),p.load("rowCount, columnCount, format"),e.next=9,t.sync();case 9:return(d=r.getRange("C".concat(c,":R").concat(c+u.rowCount-1))).copyFrom(u,Excel.RangeCopyType.values,!1,!1),d.copyFrom(u,Excel.RangeCopyType.formats,!1,!1),(f=r.getRange("A".concat(c+4,":B").concat(c+3+l.rowCount))).copyFrom(l,Excel.RangeCopyType.values,!1,!1),f.copyFrom(l,Excel.RangeCopyType.formats,!1,!1),(h=r.getRange("C".concat(c+4),String.fromCharCode(64+p.columnCount)+(c+3+p.rowCount))).copyFrom(p,Excel.RangeCopyType.values,!1,!1),h.copyFrom(p,Excel.RangeCopyType.formats,!1,!1),e.next=20,t.sync();case 20:e.next=26;break;case 22:throw e.prev=22,e.t0=e.catch(0),console.error("Erreur dans copierBlocDonnees:",e.t0),e.t0;case 26:case"end":return e.stop()}}),e,null,[[0,22]])})))).apply(this,arguments)}function $(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",i="?",s=r.toUpperCase().trim();if(g.correspondances)for(var c=0;c<g.correspondances.length;c++)if(g.correspondances[c].type.toUpperCase()===s){i=g.correspondances[c].label;break}var u=o?"".concat(n,".").concat(o," - "):"".concat(n," - ");"".concat(u,"\n").concat(i),e.save();var l=Math.max(8,10/d),p=1.1*l;e.font="".concat(l,"px Arial");var f,h=e.measureText(u).width,v=e.measureText(i).width,y=Math.max(h,v);switch(t.type){case"rectangle":f=t.width-4;break;case"circle":f=.9*t.width;break;case"ccr":f=.8*t.width-60;break;default:f=.8*t.width}if(y>f){var m=f/y;p=1.1*(l=Math.max(6,l*m*.9)),e.font="".concat(l,"px Arial")}if("circle"!==t.type){var x,b=2*p;if(b>(x="rectangle"===t.type?t.height-4:.8*t.height)){var w=x/b;p=1.1*(l=Math.max(6,l*w*.9)),e.font="".concat(l,"px Arial")}}var k=t.x,E=t.y,C="center",I="middle",R=t.width/2,A=t.height-2*R,B=t.height/2,T=t.width-2*B;switch(t.type){case"rectangle":C="left",I="top",k=t.x-t.width/2+2,E=t.y-t.height/2+2;break;case"circle":break;case"ccr":var F=Math.min(30,.2*t.width);switch(a){case"Haut":R=t.width/2,A=t.height-2*R,C="center",I="bottom",E=t.y-A/2-F;break;case"Bas":R=t.width/2,A=t.height-2*R,C="center",I="top",E=t.y+A/2+F;break;case"Haut_et_bas":R=t.width/2,A=t.height-2*R,C="center","1"===o?(I="bottom",E=t.y-A/2-F):(I="top",E=t.y+A/2+F);break;case"Gauche":B=t.height/2,T=t.width-2*B,C="right",I="middle",k=t.x-T/2-F/2;break;case"Droite":B=t.height/2,T=t.width-2*B,C="left",I="middle",k=t.x+T/2+F/2;break;case"Droite_Gauche":B=t.height/2,T=t.width-2*B,I="middle","1"===o?(C="right",k=t.x-T/2-F/2):(C="left",k=t.x+T/2+F/2)}}e.textAlign=C,e.textBaseline=I,e.fillStyle="#000",e.fillText(u,k,E),e.fillStyle="#0070C0",e.fillText(i,k,E+p),e.restore()}function ee(){I&&g&&(k&&cancelAnimationFrame(k),k=requestAnimationFrame((function(){if(c&&u&&g){u.clearRect(0,0,c.width,c.height),u.fillStyle=R?"#ffffff":"#f8f8f8",u.fillRect(0,0,c.width,c.height),u.save(),u.translate(f,h),u.scale(d,d);var e=c.height-100,t=10;g.shapes.forEach((function(n,r){var a,o;if(n){var i=g.numbers[r]||r+1,s=2*parseFloat(g.widths[r]),c=2*parseFloat(g.heights[r]),l=2*parseFloat(g.centersX[r])+50,p=e-2*parseFloat(g.centersY[r]),f=g.orientations[r]||"";if(!isNaN(s)&&!isNaN(c)){var h="shape"===(null===(a=b)||void 0===a?void 0:a.type)&&b.index===r,v="shape"===(null===(o=w)||void 0===o?void 0:o.type)&&w.index===r;if(u.strokeStyle=v?"#0066cc":h?"#0099ff":"#000",u.lineWidth=(v?3:h?2:1.5)/d,u.fillStyle=v?"rgba(0, 102, 204, 0.1)":h?"rgba(0, 153, 255, 0.05)":"transparent",n.match(/KB|KCV|KCH|KCVH|KS3P|KSDH/))u.beginPath(),u.rect(l-s/2,p-c/2,s,c),u.fill(),u.stroke(),$(u,{type:"rectangle",x:l,y:p,width:s,height:c},i,n),v&&te(u,n,l,p);else if(n.includes("Rond"))u.beginPath(),u.ellipse(l,p,s/2,s/2,0,0,2*Math.PI),u.fill(),u.stroke(),$(u,{type:"circle",x:l,y:p,radius:s/2},i,n,"",1),v&&te(u,n,l,p);else if(n.includes("CCR")){var y=f.includes("Haut_et_bas")||f.includes("Droite_Gauche"),m=f.match(/Droite|Gauche/)?c:s,x=f.match(/Droite|Gauche/)?s:c,k=m/2;u.save(),u.translate(l,p),f.includes("Droite")?u.rotate(Math.PI/2):f.includes("Gauche")?u.rotate(-Math.PI/2):f.includes("Bas")&&u.rotate(Math.PI),y?(Ue(u,0,-x/2+k+t,k,!0),Ue(u,0,x/2-k-t,k,!1),u.beginPath(),u.moveTo(-k,-x/2+k+t),u.lineTo(-k,x/2-k-t),u.stroke(),u.beginPath(),u.moveTo(k,-x/2+k+t),u.lineTo(k,x/2-k-t),u.stroke(),u.restore(),$(u,{type:"ccr",x:l,y:p,width:m,height:x},i,n,f,"1"),$(u,{type:"ccr",x:l,y:p,width:m,height:x},i,n,f,"2")):(Ue(u,0,-x/2+k+t,k,!0),u.beginPath(),u.moveTo(-k,-x/2+k+t),u.lineTo(-k,x/2),u.lineTo(k,x/2),u.lineTo(k,-x/2+k+t),u.stroke(),u.restore(),$(u,{type:"ccr",x:l,y:p,width:m,height:x},i,n,f,"1")),v&&te(u,n,l,p)}}}})),x&&x.length>0&&x.forEach((function(t,n){var r,a;if(t){var o="drilling"===(null===(r=b)||void 0===r?void 0:r.type)&&b.index===n,i="drilling"===(null===(a=w)||void 0===a?void 0:a.type)&&w.index===n;!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=5/d,o=r?1.8*a:n?1.4*a:a;u.beginPath(),u.arc(e,t,o,0,2*Math.PI),u.fillStyle=r?"#cc0000":n?"#ff3333":"red",u.fill(),u.strokeStyle="#fff",u.lineWidth=.5/d,u.stroke()}(t.x,t.y,o,i),i&&function(e,t,n,r){e.save(),e.font="".concat(Math.max(8,10/d),"px Arial"),e.fillStyle="#cc0000",e.textAlign="center",e.fillText(t,n,r-10/d),e.restore()}(u,"X: ".concat((t.x-50)/2,", Y: ").concat((e-t.y)/2),t.x,t.y)}})),u.restore()}})))}function te(e,t,n,r){e.save(),e.font="".concat(Math.max(10,12/d),"px Arial"),e.fillStyle="#0066cc",e.textAlign="center",e.fillText(t,n,r-15/d),e.restore()}function ne(){return re.apply(this,arguments)}function re(){return re=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Excel.run(function(){var e=s(o().mark((function e(t){var n,r,a,i,s,c,u,l,p,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.workbook.worksheets.getItem("Feuil1"),r=n.getRange("B37:B160"),a=n.getRange("F37:F160"),i=n.getRange("G37:G160"),s=n.getRange("I37:I160"),c=n.getRange("J37:J160"),u=n.getRange("D37:D160"),l=n.getRange("A37:A160"),p=n.getRange("A8:B32"),r.load("values"),a.load("values"),i.load("values"),s.load("values"),c.load("values"),u.load("values"),l.load("values"),p.load("values"),e.next=19,t.sync();case 19:if(r.values&&0!==r.values.length){e.next=21;break}throw new Error("Aucune donnée dans la plage des formes (B37:B160)");case 21:return d=[],p.values&&p.values.length>0&&(d=p.values.map((function(e){return{label:e[0]||"?",type:e[1]||""}})).filter((function(e){return e.type}))),e.abrupt("return",{shapes:r.values.flat(),widths:a.values.flat(),centersX:i.values.flat(),heights:s.values.flat(),centersY:c.values.flat(),orientations:u.values.flat(),numbers:l.values.flat(),correspondances:d});case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),console.error("Erreur dans getShapeDataFromExcel:",e.t0),OfficeHelpers.UI.notify("Erreur lors de la récupération des données. Vérifiez Feuil1."),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,null,[[0,6]])}))),re.apply(this,arguments)}function ae(){return oe.apply(this,arguments)}function oe(){return(oe=s(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"drilling"!==p.currentScreen&&S("drilling"),e.prev=1,(t=document.getElementById("generate-recenter-btn")).disabled=!0,t.textContent="Chargement...",g=null,I=!1,ie(),e.next=10,ne();case 10:if(g=e.sent){e.next=13;break}throw new Error("Aucune donnée valide reçue d'Excel");case 13:return be(),ee(),t.textContent="Recentrer",t.style.backgroundColor="#fd7e14",t.disabled=!1,e.abrupt("return",!0);case 21:return e.prev=21,e.t0=e.catch(1),console.error("Erreur:",e.t0),(n=document.getElementById("generate-recenter-btn"))&&(n.textContent="Générer le plan 2D",n.style.backgroundColor="#0078d7",n.disabled=!1),xe("Erreur lors du chargement. Vérifiez les données Excel."),e.abrupt("return",!1);case 28:case"end":return e.stop()}}),e,null,[[1,21]])})))).apply(this,arguments)}function ie(){var e=document.getElementById("drawing-area");e.innerHTML="",(c=document.createElement("canvas")).width=e.offsetWidth,c.height=e.offsetHeight,e.appendChild(c),u=c.getContext("2d"),c.style.cursor="default",u.fillStyle="#f8f8f8",u.fillRect(0,0,c.width,c.height),(l=document.createElement("div")).className="canvas-tooltip",document.getElementById("drawing-area").appendChild(l),I=!1}function se(){return ce.apply(this,arguments)}function ce(){return ce=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Excel.run(function(){var e=s(o().mark((function e(t){var n,i,s,c,u,l,p,d,f,h,v,y,m,g;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.workbook.worksheets.getItem("ACCUEIL")).getRange("BR13:CE109").clear(),(i=n.getRange("AC13:AC109")).load("values"),e.next=7,t.sync();case 7:return n.getRange("I13:I109").values=i.values,s=n.getRange("A13:A109"),c=n.getRange("I13:I109"),u=n.getRange("M13:T109"),l=n.getRange("Y13:AB109"),s.load("values"),c.load("values"),u.load("values"),l.load("values"),e.next=19,t.sync();case 19:for(p=[],d=0;d<97;d++){for((f=[]).push(s.values[d][0]),f.push(c.values[d][0]),h=0;h<8;h++)f.push(u.values[d][h]);for(v=0;v<4;v++)f.push(l.values[d][v]);p.push(f)}return(y=n.getRange("BR13:CE109")).values=p,y.load("values"),e.next=27,t.sync();case 27:return m={"KIT DE BASE  -  KB":0,"KIT CONTIGU VERTICAL - KCV":1,"KIT CONTIGU HORIZONTAL - KCH":2,"KIT CONTIGU VERTICAL ET HORIZONTAL - KCVH":3,"KIT SPÉCIAL 3 POINTS - KS3P":4},(o=y.values,g=function(e){if(Array.isArray(e))return a(e)}(o)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||r(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).sort((function(e,t){var n=e[1]||"",r=t[1]||"";return(m[n]||99)-(m[r]||99)})),y.values=g,n.getRange("BS:BS").format.columnWidth=36.13,e.next=35,t.sync();case 35:case"end":return e.stop()}var o}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Error:",e.t0),OfficeHelpers.UI.notify(e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,5]])}))),ce.apply(this,arguments)}function ue(){return(ue=s(o().mark((function e(){var t,n,r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("calculate-kits-btn"),n=t.textContent,r=t.style.backgroundColor,a=[],e.prev=4,t.disabled=!0,t.style.backgroundColor="#cccccc",t.textContent="Transfert en cours... merci de patienter",e.next=10,K("ACCUEIL");case 10:if(e.sent){e.next=14;break}return e.next=14,V("ACCUEIL");case 14:return e.next=16,U("ACCUEIL");case 16:return e.next=18,se();case 18:return e.next=20,de("Feuil1",!1,"Gp4r!74.");case 20:return e.next=22,de("RecapTubes",!1,"Gp4r!74.");case 22:return a=["Feuil1","RecapTubes"],e.next=25,ve();case 25:return e.next=27,me();case 27:return e.next=29,le(a);case 29:a=[],t.style.backgroundColor="#28a745",t.textContent="✔️ Transfert réalisé avec succès !",he("Vous pouvez passer à l'étape 2"),e.next=43;break;case 35:if(e.prev=35,e.t0=e.catch(4),console.error("Erreur lors du transfert :",e.t0),!(a.length>0)){e.next=41;break}return e.next=41,le(a).catch((function(e){console.error("Erreur lors du reverrouillage d'urgence :",e)}));case 41:t.style.backgroundColor="#dc3545",t.textContent="❌ Erreur lors du transfert";case 43:return e.prev=43,setTimeout((function(){t.disabled=!1,t.style.backgroundColor=r,t.textContent=n}),3e3),e.finish(43);case 46:case"end":return e.stop()}}),e,null,[[4,35,43,46]])})))).apply(this,arguments)}function le(e){return pe.apply(this,arguments)}function pe(){return(pe=s(o().mark((function e(t){var r,a,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n(t),e.prev=1,r.s();case 3:if((a=r.n()).done){e.next=15;break}return i=a.value,e.prev=5,e.next=8,de(i,!0,"Gp4r!74.");case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),console.error("Échec du verrouillage de ".concat(i,":"),e.t0);case 13:e.next=3;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(1),r.e(e.t1);case 20:return e.prev=20,r.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[1,17,20,23],[5,10]])})))).apply(this,arguments)}function de(e,t,n){return fe.apply(this,arguments)}function fe(){return fe=s(o().mark((function e(t,n,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Excel.run(function(){var e=s(o().mark((function e(a){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.workbook.worksheets.getItem(t),n?i.protection.protect({allowAutoFilter:!0,allowDeleteRows:!1,allowFormatCells:!1,allowFormatColumns:!1,allowFormatRows:!1,allowInsertColumns:!1,allowInsertRows:!1,allowSort:!1,selectionMode:"none"},r):i.protection.unprotect(r),e.next=4,a.sync();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)}))),fe.apply(this,arguments)}function he(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,n=document.createElement("div");n.style.cssText="\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        color: white;\n        padding: 12px 40px 12px 20px;\n        border-radius: 6px;\n        z-index: 1000;\n        font-family: 'Segoe UI', system-ui, sans-serif;\n        font-size: 14px;\n        font-weight: 500;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n        backdrop-filter: blur(6px);\n        border: 1px solid rgba(255,255,255,0.2);\n        animation: fadeIn 0.25s ease-out;\n        cursor: default;\n        max-width: 300px;\n        line-height: 1.5;\n        overflow: hidden;\n    ";var r=document.createElement("div");r.style.cssText="\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background-color: #28a745;\n        opacity: 0.6;\n        z-index: -1;\n    ",n.appendChild(r),n.innerHTML+='\n        <span style="\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            position: relative;\n            z-index: 1;\n        ">\n            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>\n                <polyline points="22 4 12 14.01 9 11.01"></polyline>\n            </svg>\n            '.concat(e,'\n        </span>\n        <span class="close-btn" style="\n            position: absolute;\n            top: 10px;\n            right: 10px;\n            width: 16px;\n            height: 16px;\n            cursor: pointer;\n            opacity: 0.7;\n            transition: opacity 0.2s;\n            z-index: 2;\n        ">&times;</span>\n    ');var a=document.createElement("style");a.textContent="\n        @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(-15px) scale(0.95); }\n            to { opacity: 1; transform: translateY(0) scale(1); }\n        }\n        @keyframes fadeOut {\n            to { opacity: 0; transform: translateY(-15px) scale(0.95); }\n        }\n    ",document.head.appendChild(a),document.body.appendChild(n);var o,i=n.querySelector(".close-btn"),s=function(){clearTimeout(o),n.style.animation="fadeOut 0.2s forwards",setTimeout((function(){n.remove(),a.remove()}),200)};i.addEventListener("click",s),i.addEventListener("mouseenter",(function(){return i.style.opacity="1"})),i.addEventListener("mouseleave",(function(){return i.style.opacity="0.7"})),o=setTimeout(s,t)}function ve(){return ye.apply(this,arguments)}function ye(){return ye=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Excel.run(function(){var e=s(o().mark((function e(n){var r,a,i,c,u,l,p,d,f,h,v,y,m,g,x,b,w,k,E,C,I,R,A,B,T,F,L,S,P,D,M,O,G,H,K,N,U,_,V,Y,j,z,q,X,J,W,Z,Q;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(d=function(){return(d=s(o().mark((function e(t,r){var a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.getRange(t),e.next=3,r.copyFrom(a,Excel.RangeCopyType.all,!1,!1);case 3:return e.next=5,n.sync();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)},p=function(e,t){return d.apply(this,arguments)},r=n.workbook,a=r.worksheets.getItem("ACCUEIL"),i=r.worksheets.getItem("Feuil1"),c=0,u=["A","B","D","F","G","I","J"];c<u.length;c++)l=u[c],i.getRange("".concat(l,"37:").concat(l,"436")).clear();return e.next=9,n.sync();case 9:return(h=(f=[{source:"D2",dest:"C4"},{source:"D3",dest:"E4"},{source:"D4",dest:"C6"},{source:"D5",dest:"C3"},{source:"D6",dest:"C5"},{source:"AD13",dest:"C8"},{source:"AE13",dest:"C10"},{source:"AF13",dest:"C9"},{source:"AG13",dest:"C11"},{source:"AH13",dest:"C12"},{source:"AI13",dest:"C14"},{source:"AJ13",dest:"C15"},{source:"AK13",dest:"C16"},{source:"AL13",dest:"C17"},{source:"AM13",dest:"C18"},{source:"AN13",dest:"C19"},{source:"AO13",dest:"C20"},{source:"AP13",dest:"C21"},{source:"AQ13",dest:"C22"},{source:"AR13",dest:"C24"},{source:"AS13",dest:"C25"},{source:"AT13",dest:"C26"},{source:"AU13",dest:"C27"},{source:"AV13",dest:"C28"},{source:"AW13",dest:"C29"},{source:"AX13",dest:"C30"},{source:"AY13",dest:"C31"},{source:"AZ13",dest:"C32"},{source:"BA13",dest:"D14"},{source:"BB13",dest:"D15"},{source:"BC13",dest:"D16"},{source:"BD13",dest:"D17"},{source:"BE13",dest:"D18"},{source:"BF13",dest:"D19"},{source:"BG13",dest:"D20"},{source:"BH13",dest:"D21"},{source:"BI13",dest:"D22"}]).map((function(e){return a.getRange(e.source)}))).forEach((function(e){return e.load("values")})),e.next=14,n.sync();case 14:for(v=0;v<f.length;v++)i.getRange(f[v].dest).values=h[v].values;return y=i.getRange("A8:A32"),m=i.getRange("B8:B32"),y.load("text"),m.load("text"),e.next=21,n.sync();case 21:for(g={},x=0;x<y.text.length;x++)(w=(null===(b=y.text[x][0])||void 0===b?void 0:b.trim())||"")&&(g[w]=x+8);return(k=a.getRange("A13:A436")).load("values"),e.next=27,n.sync();case 27:E=13,C=k.values.length-1;case 29:if(!(C>=0)){e.next=36;break}if(null===k.values[C][0]||""===k.values[C][0]){e.next=33;break}return E=13+C,e.abrupt("break",36);case 33:C--,e.next=29;break;case 36:if(!(E<13)){e.next=38;break}return e.abrupt("return");case 38:return(I=a.getRange("A13:I".concat(E))).load("values"),e.next=42,n.sync();case 42:for(R=I.values,A=[],B=0;B<R.length;B++)T=t(R[B],9),F=T[0],L=T[1],S=T[2],P=T[3],D=T[4],M=T[5],O=T[6],G=T[7],H=T[8],K=L,(N=(H+"").trim()).includes("-")&&(N=N.split("-")[1].trim()),U=99,_=N,g.hasOwnProperty(N)&&(U=g[N],_=m.text[U-8][0]),A.push([U-7,_,G,O,M,D,P,F]),"Caisson avec alcove"!==K||isNaN(S)||(V="CCR".concat(parseFloat(S)/2),g[V]&&(Y=g[V],j=m.text[Y-8][0],A.push([Y-7,j,G,O,M,D,P,F]))),"Caisson avec rond"!==K||isNaN(S)||(z="KR".concat(parseFloat(S)/2),g[z]&&(q=g[z],X=m.text[q-8][0],A.push([q-7,X,G,S,M,S,P,F])));A.sort((function(e,t){return e[0]-t[0]})),J=0;case 47:if(!(J<A.length)){e.next=64;break}if(W=37+J,Z=A[J],i.getRange("A".concat(W)).values=[[Z[7]]],i.getRange("B".concat(W)).values=[[Z[1]]],i.getRange("J".concat(W)).values=[[Z[2]]],i.getRange("I".concat(W)).values=[[Z[3]]],i.getRange("G".concat(W)).values=[[Z[4]]],i.getRange("F".concat(W)).values=[[Z[5]]],i.getRange("D".concat(W)).values=[[Z[6]]],99===Z[0]){e.next=61;break}return Q=Z[0]+7,e.next=61,p("B".concat(Q),i.getRange("B".concat(W)));case 61:J++,e.next=47;break;case 64:return e.next=66,n.sync();case 66:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Erreur :",e.t0),e.t0.debugInfo&&console.error("Détails :",e.t0.debugInfo);case 9:case"end":return e.stop()}}),e,null,[[0,5]])}))),ye.apply(this,arguments)}function me(){return ge.apply(this,arguments)}function ge(){return ge=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Excel.run(function(){var e=s(o().mark((function e(t){var n,r,a,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.workbook.worksheets.getItem("Feuil1"),r=t.workbook.worksheets.getItem("RecapTubes"),(a=n.getRange("B37:B170")).load("values"),e.next=6,t.sync();case 6:return i=r.getRange("B14").getResizedRange(133,0),e.next=9,i.copyFrom(a,Excel.RangeCopyType.all,!1,!1);case 9:return e.next=11,t.sync();case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)}))),ge.apply(this,arguments)}function xe(e){var t=document.getElementById("error-message");t&&(t.textContent=e,t.style.display="block")}function be(){var e=document.getElementById("drawing-area");e?(e.innerHTML="",c=document.createElement("canvas"),R?(c.width=1020,c.height=700):(c.width=e.offsetWidth,c.height=e.offsetHeight),e.appendChild(c),u=c.getContext("2d"),c.style.cursor="grab",c.removeEventListener("wheel",He),c.removeEventListener("mousedown",Ke),c.removeEventListener("mousemove",ke),c.removeEventListener("click",Ae),c.removeEventListener("mouseup",Ne),c.removeEventListener("mouseleave",Ne),c.addEventListener("wheel",He),c.addEventListener("mousedown",(function(e){Ke(e),e.preventDefault()})),c.addEventListener("mousemove",(function(e){v?function(e){if(I&&v&&c){var t=e.clientX-y,n=e.clientY-m;f+=t,h+=n,y=e.clientX,m=e.clientY,ee()}}(e):ke(e)})),c.addEventListener("click",Ae),c.addEventListener("mouseup",Ne),c.addEventListener("mouseleave",Ne),function(){if(g){for(var e=1/0,t=-1/0,n=1/0,r=-1/0,a=c.height-100,o=0;o<g.shapes.length;o++)if(g.shapes[o]){var i=2*parseFloat(g.centersX[o])+50,s=a-2*parseFloat(g.centersY[o]),u=2*parseFloat(g.widths[o]),l=2*parseFloat(g.heights[o]);e=Math.min(e,i-u/2),t=Math.max(t,i+u/2),n=Math.min(n,s-l/2),r=Math.max(r,s+l/2)}var p=t-e,v=r-n;d=Math.min(c.width/(1.1*p),c.height/(1.1*v)),f=(c.width-p*d)/2-e*d,h=(c.height-v*d)/2-n*d}}(),I=!0,ee()):console.error("Element 'drawing-area' non trouvé")}function we(){d=1,f=0,h=0,b=null,w=null,x=[],E=0,C=[],g=null,I=!1;var e=document.getElementById("generate-recenter-btn");e.textContent="Générer le plan 2D",e.style.backgroundColor="#0078d7",ie(),l&&(l.style.display="none");var t=document.getElementById("error-message");t&&(t.style.display="none",t.textContent="")}function ke(e){if(I&&!v){var t=Le(c,e),n=Se(t.x,t.y),r=Ee(n);r||(r=Ce(n)),b&&r&&b.type===r.type&&b.index===r.index||(b=r,ee()),Be(e,r)}}function Ee(e){if(!x||0===x.length)return null;for(var t=10/d,n=x.length-1;n>=0;n--){var r=x[n];if(r&&Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))<t)return{type:"drilling",index:n}}return null}function Ce(e){for(var t=c.height-100,n=[],r=0;r<g.shapes.length;r++)if(g.shapes[r]){var a=2*parseFloat(g.centersX[r])+50,o=t-2*parseFloat(g.centersY[r]),i=2*parseFloat(g.widths[r]),s=2*parseFloat(g.heights[r]),u=g.orientations[r]||"";Ie(e,g.shapes[r],a,o,i,s,u)&&n.push({type:"shape",index:r,shapeType:g.shapes[r],width:i,height:s,centerX:a,centerY:o})}return n.sort((function(e,t){var n=e.width*e.height,r=t.width*t.height;if(Math.abs(n-r)<100){var a=e.shapeType.includes("CCR"),o=t.shapeType.includes("CCR");if(a&&!o)return-1;if(!a&&o)return 1}return n-r}))[0]||null}function Ie(e,t,n,r,a,o,i){var s=2/d;return t.includes("Kit de base")||t.includes("Kit contigu")||t.includes("Kit spécial")?function(e,t,n,r,a,o){var i=t-r/2-o,s=t+r/2+o,c=n-a/2-o,u=n+a/2+o;return e.x>=i&&e.x<=s&&e.y>=c&&e.y<=u}(e,n,r,a,o,s):t.includes("Kit Rond")?function(e,t,n,r,a){var o=e.x-t,i=e.y-n;return Math.sqrt(o*o+i*i)<=r+a}(e,n,r,a/2,s):!!t.includes("CCR")&&function(e,t,n,r,a,o,i){var s=r/2,c=e.x-t,u=e.y-n;if(o.includes("Droite")){var l=[u,-c];c=l[0],u=l[1]}else if(o.includes("Gauche")){var p=[-u,c];c=p[0],u=p[1]}else if(o.includes("Bas")){var d=[-c,-u];c=d[0],u=d[1]}var f=o.includes("Haut_et_bas")||o.includes("Droite_Gauche"),h=-a/2+s+10,v=a/2-s-10;if(u<h+i){var y=c,m=u-h;return Math.sqrt(y*y+m*m),y*y+m*m<=(s+i)*(s+i)&&c>=-s-i&&c<=s+i}if(f&&u>v-i){var g=c,x=u-v;return Math.sqrt(g*g+x*x),g*g+x*x<=(s+i)*(s+i)&&c>=-s-i&&c<=s+i}var b=c>=-s-i&&c<=s+i&&u>=h-i&&u<=(f?v+i:a/2+i),w=(Math.abs(c+s)<=i||Math.abs(c-s)<=i)&&u>=h-i&&u<=(f?v+i:a/2+i);return b||w}(e,n,r,a,o,i,s)}function Re(e,t,n){return n.includes("Kit Rond")?Math.PI*Math.pow(e/2,2):n.includes("CCR")?e*t*.3:e*t}function Ae(e){if(I&&!v&&c){var t=Le(c,e),n=Se(t.x,t.y),r=Ee(n);if(r)return w=r,C=[],ee(),void Te(e,w);var a=Ce(n);if(!a)return w=null,C=[],ee(),void Fe();w&&w.type===a.type&&w.index===a.index?(E=(E+1)%C.length,w=C[E]):(C=function(e){for(var t=c.height-100,n=[],r=0;r<g.shapes.length;r++)if(g.shapes[r]){var a=2*parseFloat(g.centersX[r])+50,o=t-2*parseFloat(g.centersY[r]),i=2*parseFloat(g.widths[r]),s=2*parseFloat(g.heights[r]);Ie(e,g.shapes[r],a,o,i,s,g.orientations[r])&&n.push({type:"shape",index:r,shapeType:g.shapes[r],priority:(u=g.shapes[r],u.includes("CCR")?3:u.includes("Kit Rond")?2:1),area:Re(i,s,g.shapes[r])})}var u;return n.sort((function(e,t){return t.priority!==e.priority?t.priority-e.priority:e.area-t.area}))}(n),E=0,w=a),ee(),Te(e,w)}}function Be(e,t){if(l&&t){var n=Le(c,e);if(l.style.left="".concat(n.x+15,"px"),l.style.top="".concat(n.y+15,"px"),"drilling"===t.type){var r=x[t.index],a=c.height-100,o=(r.x-50)/2,i=(a-r.y)/2;l.textContent="Point de perçage (".concat(o.toFixed(1),", ").concat(i.toFixed(1),")"),l.style.display="block"}else"shape"===t.type&&(l.textContent=g.shapes[t.index],l.style.display="block")}else Fe()}function Te(e,t){l&&(Be(e,t),l.classList.add("active"))}function Fe(){l&&(l.style.display="none",l.classList.remove("active"))}function Le(e,t){if(!e)return{x:0,y:0};var n=e.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}function Se(e,t){return{x:(e-f)/d,y:(t-h)/d}}function Pe(){return De.apply(this,arguments)}function De(){return(De=s(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,I&&g){e.next=4;break}return xe("Veuillez d'abord générer le plan 2D en cliquant sur 'Générer le plan 2D'"),e.abrupt("return");case 4:if(t=document.getElementById("place-drilling-btn")){e.next=7;break}throw new Error("Bouton non trouvé");case 7:return t.disabled=!0,t.textContent="Chargement...",e.next=11,Me();case 11:Ge(e.sent),t.textContent="Placer les points",t.disabled=!1,e.next=23;break;case 17:e.prev=17,e.t0=e.catch(0),console.error("Erreur:",e.t0),(n=document.getElementById("place-drilling-btn"))&&(n.textContent="Erreur - Réessayer",n.disabled=!1),xe("Erreur lors du placement des points");case 23:case"end":return e.stop()}}),e,null,[[0,17]])})))).apply(this,arguments)}function Me(){return Oe.apply(this,arguments)}function Oe(){return Oe=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Excel.run(function(){var e=s(o().mark((function e(t){var n,r,a,i,s,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.workbook.worksheets.getItem("Feuil2"),r=t.workbook.worksheets.getItem("A reporter"),a=n.getRange("A20:A200"),i=n.getRange("B20:I200"),s=r.getRange("B5:AG200"),c=n.getRange("AR20:BW200"),a.load("values"),i.load("values"),s.load("values"),c.load("values"),e.next=12,t.sync();case 12:return e.abrupt("return",{types:a.values,kbPoints:i.values,ccrPoints:s.values,rondPoints:c.values});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),Oe.apply(this,arguments)}function Ge(e){if(c&&u&&g){x=[];for(var t=c.height-100,n=0;n<e.types.length;n++)if(e.types[n]&&""!==e.types[n][0]){var r=e.types[n][0];if(r.includes("KB")||r.includes("KCV")||r.includes("KCH")||r.includes("KCVH")||r.includes("KS3P")||r.includes("KSDH")){for(var a=0;a<8;a+=2)if(e.kbPoints[n]&&""!==e.kbPoints[n][a]){var o=2*parseFloat(e.kbPoints[n][a])+50,i=t-2*parseFloat(e.kbPoints[n][a+1]);x.push({x:o,y:i})}}else if(r.includes("CCR")){for(var s=0;s<32;s+=2)if(e.ccrPoints[n]&&""!==e.ccrPoints[n][s]){var l=2*parseFloat(e.ccrPoints[n][s])+50,p=t-2*parseFloat(e.ccrPoints[n][s+1]);x.push({x:l,y:p})}}else if(r.includes("Rond"))for(var d=0;d<32;d+=2)if(e.rondPoints[n]&&""!==e.rondPoints[n][d]){var f=2*parseFloat(e.rondPoints[n][d])+50,h=t-2*parseFloat(e.rondPoints[n][d+1]);x.push({x:f,y:h})}}ee()}else console.error("Le canvas n'est pas initialisé")}function He(e){if(I&&c){e.preventDefault();var t=e.clientX-c.getBoundingClientRect().left,n=e.clientY-c.getBoundingClientRect().top,r=e.deltaY<0?1.1:.9;f-=t,h-=n,f*=r,h*=r,f+=t,h+=n,d*=r,ee()}}function Ke(e){v=!0,y=e.clientX,m=e.clientY,c.style.cursor="grabbing"}function Ne(){v=!1,c.style.cursor="grab"}function Ue(e,t,n,r,a){e.beginPath(),e.arc(t,n,r,Math.PI,a?0:2*Math.PI,!a),e.stroke()}Office.onReady((function(){var e;L(),S("welcome"),document.getElementById("start-btn").addEventListener("click",(function(){return S("menu")})),document.getElementById("drilling-plan-btn").addEventListener("click",(function(){return S("drilling")})),document.getElementById("back-to-menu").addEventListener("click",(function(){return S("menu")})),null===(e=document.getElementById("back-to-menu-btn"))||void 0===e||e.addEventListener("click",(function(){return S("menu")})),document.getElementById("generate-recenter-btn").addEventListener("click",ae),document.getElementById("place-drilling-btn").addEventListener("click",Pe),document.getElementById("reset-view-btn").addEventListener("click",we),document.getElementById("calculate-kits-btn").addEventListener("click",(function(){A&&(A=!1,Excel.run(function(){var e=s(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.workbook.worksheets.getItem("ACCUEIL"),(r=n.getRange("B13:H120")).load("values"),e.next=5,t.sync();case 5:B=JSON.stringify(r.values),setInterval(s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!F){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,Excel.run(function(){var e=s(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.workbook.worksheets.getItem("ACCUEIL").getRange("B13:H120")).load("values"),e.next=4,t.sync();case 4:(r=JSON.stringify(n.values))===B||T||(T=!0,Y(),B=r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log("Erreur de surveillance :",e.t0);case 10:case"end":return e.stop()}}),e,null,[[2,7]])}))),5e3);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),function(){ue.apply(this,arguments)}()})),document.getElementById("prepare-pdf-btn").addEventListener("click",j),document.getElementById("finish-export-btn").addEventListener("click",M),document.getElementById("reset-project-btn").addEventListener("click",(function(){document.getElementById("confirm-reset").style.display="flex"})),document.getElementById("confirm-yes").addEventListener("click",s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return document.getElementById("confirm-reset").style.display="none",e.next=3,P();case 3:case"end":return e.stop()}}),e)})))),document.getElementById("confirm-no").addEventListener("click",(function(){document.getElementById("confirm-reset").style.display="none"}))}))}();
//# sourceMappingURL=taskpane.js.map